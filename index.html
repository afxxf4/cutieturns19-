<script>
  let tag = document.createElement('script');
  tag.src = "https://www.youtube.com/iframe_api";
  document.body.appendChild(tag);

  let player;
  function onYouTubeIframeAPIReady() {
    player = new YT.Player('ytplayer', {
      height: '0',
      width: '0',
      videoId: 'VjipUXcbGKA',
      playerVars: {
        autoplay: 0,
        loop: 1,
        playlist: 'VjipUXcbGKA'
      }
    });
  }

  let step = 0;
  let noteShown = false;
  const scene1 = document.getElementById("scene1");
  const scene2 = document.getElementById("scene2");
  const cakeScene = document.getElementById("cakeScene");
  const goodBoyBtn = document.getElementById("goodBoyBtn");
  const note = document.getElementById("note");

  scene1.style.opacity = 1;

  const eventType = ('ontouchstart' in window) ? 'touchstart' : 'click';
  document.body.addEventListener(eventType, handleTap);

  function handleTap() {
    step++;
    if (step === 1) {
      scene1.style.opacity = 0;
      setTimeout(() => scene2.style.opacity = 1, 1000);
    } else if (step === 2) {
      scene2.style.opacity = 0;
      setTimeout(() => {
        cakeScene.style.display = "block";
        cakeScene.style.opacity = 0;
        cakeScene.style.transition = "opacity 2s"; // smooth fade
        setTimeout(() => {
          cakeScene.style.opacity = 1;
        }, 50);
      }, 3000); // ⏳ wait 3 seconds before showing cake
    } else if (step === 3) {
      const flames = document.querySelectorAll(".flame");
      flames.forEach(f => {
        f.style.animation = "blowOut 1.5s forwards";
      });
      const styleEl = document.createElement("style");
      styleEl.textContent = `@keyframes blowOut { to { transform:translateX(-50%) scale(0); opacity:0; } }`;
      document.head.appendChild(styleEl);
      setTimeout(() => spawnBalloons(15), 1500);
      setTimeout(() => goodBoyBtn.style.display = "block", 3000);
    }
  }

  goodBoyBtn.addEventListener("click", () => {
    if (!noteShown) {
      cakeScene.style.display = "none";
      note.classList.add("show");
      goodBoyBtn.textContent = "surprise mee :p";
      noteShown = true;
      spawnHearts(200);
    } else {
      if (player && player.playVideo) {
        player.playVideo();
      }
    }
  });

  function spawnBalloons(count) {
    const colors = ["#ff4d6d", "#ff7f7f", "#e75480", "#ff9999", "#cc3366"];
    for (let i = 0; i < count; i++) {
      let b = document.createElement("div");
      b.className = "balloon";
      b.style.left = Math.random() * 90 + "vw";
      b.style.background = colors[Math.floor(Math.random() * colors.length)];
      b.style.animationDuration = (4 + Math.random() * 2) + "s";
      document.body.appendChild(b);
      setTimeout(() => b.remove(), 6000);
    }
  }

  function spawnHearts(count) {
    for (let i = 0; i < count; i++) {
      let heart = document.createElement("div");
      heart.className = "heart";
      heart.style.left = Math.random() * 100 + "vw";
      heart.style.top = Math.random() * 100 + "vh";
      heart.style.fontSize = (Math.random() * 20 + 10) + "px";
      heart.textContent = "❤️";
      document.body.appendChild(heart);
    }
    setTimeout(() => {
      document.querySelectorAll(".heart").forEach(h => h.remove());
    }, 4000);
  }
</script>
